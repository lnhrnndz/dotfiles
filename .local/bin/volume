#!/bin/fish

set sink (pactl get-default-sink)
test -z "$sink" && exit 1

argparse h/help u/up= d/down= m/mute s/set= -- $argv
or return

if set -q _flag_help
  echo "volume [-h|--help] [-u|--up] [-d|--down] [-s|--set]"
  exit 0
end

if set -q _flag_up
  pactl set-sink-volume "$sink" "+$_flag_up%"
end

if set -q _flag_down
  pactl set-sink-volume "$sink" "-$_flag_down%"
end

if set -q _flag_mute
  pactl set-sink-mute "$sink" toggle
end

if set -q _flag_set
  pactl set-sink-volume "$sink" "$_flag_set%"
end

set volume (pactl get-sink-volume "$sink" | head -n 1 | awk '{ print $5 }'# | sed 's/%//')
test "$volume" -gt 100; and set volume 100
test "$volume" -lt 0; and set volume 0

pactl set-sink-volume "$sink" "$volume%"

set mute (pactl get-sink-mute "$sink" | awk '{ print $2 }')

# notify
if test "$mute" = "yes"
  dunstify -a "volume" -u low -r 444 -h int:value:"$volume" "Muted" -t 2000
else
  dunstify -a "volume" -u low -r 444 -h int:value:"$volume" "Volume: $volume%" -t 2000
end

exit 0
