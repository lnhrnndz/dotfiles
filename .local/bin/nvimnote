#!/bin/sh

FOLDER="$HOME/wikis/EncyclopediaGalactica/notes/"
DATE=$(date +%Y%m%d)

hex() {
    hexas="0123456789abcdef"
    dec="$1"

    tens=$(( dec / 16 + 1 ))
    ones=$(( dec % 16 + 1 ))
    
    tens=$(echo "$hexas" | cut -c"$tens")
    ones=$(echo "$hexas" | cut -c"$ones")

    echo "$tens$ones"
}

new() {
    ID=0
    HEX_ID=$(hex "$ID")
    ZET="$DATE-$HEX_ID.md"

    UNIQUE="false"
    while [ ! "$UNIQUE" = "true" ]; do
        if [ ! -e "$FOLDER$ZET" ]; then
            UNIQUE="true"
        else
            ID=$(( ID + 1 ))
            HEX_ID=$(hex "$ID")
            ZET="$DATE-$HEX_ID.md"
        fi
    done
}
daily() {
    ZET="$DATE.md"
}
monthly() {
    ZET="$(date +%Y%m).md"
}
yearly() {
    ZET="$(date +%Y).md"
}

case "$1" in
    "new") new ;;
    "daily") daily ;;
    "monthly") monthly ;;
    "yearly") yearly ;;
    *) 
        st -t note -c note -e \
            nvim \
            -c "cd $FOLDER" \
            -c "cd .." &
        exit
        ;;
esac

st -t note -c note -e \
    nvim \
    -c "cd $FOLDER" \
    -c "cd .." \
    -c "norm i" \
    "$FOLDER$ZET" &
