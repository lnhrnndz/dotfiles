#!/bin/sh

if [ "$1" = "reload" ]; then
    setxkbmap -option caps:ctrl_modifier
    xset r rate 200 36
    exit 0
fi

OPTIONS="\
us
ch"

n=$(echo "$OPTIONS" | wc -l)

if [ "$1" = "next" ]; then
    CURRENT=$(setxkbmap -query | awk '/layout/{print $2}')
    CURRENTNR=$(echo "$OPTIONS" | awk "/$CURRENT/ { print NR }")
    NEXTNR=$(( (CURRENTNR) % n + 1 ))
    CHOICE=$(echo "$OPTIONS" | sed -n "${NEXTNR}p")
    echo "$CHOICE"
elif [ -z "$1" ]; then
    #n="$(echo "$OPTIONS" | tr -d ' ' | wc -w)"
    if ! which rofi 2> /dev/null > /dev/null; then
        echo "rofi is not installed"
        echo "aborting"
        exit
    fi
    CHOICE=$(echo "$OPTIONS" | rofi -dmenu -l "$n" -p "Select layout")
    [ -z "$CHOICE" ] && exit 1
else
    echo "$OPTIONS" | grep -q "$1" || exit 2
    CHOICE="$1"
fi


setxkbmap "$CHOICE"

dunstify -a keyboard -u low -r 666 "keyboard layout set to $CHOICE"
